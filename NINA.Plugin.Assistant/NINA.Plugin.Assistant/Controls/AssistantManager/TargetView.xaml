<UserControl
    x:Class="Assistant.NINAPlugin.Controls.AssistantManager.TargetView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:astro="clr-namespace:NINA.Astrometry;assembly=NINA.Astrometry"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Assistant.NINAPlugin.Controls.AssistantManager"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:nrules="clr-namespace:NINA.Core.Utility.ValidationRules;assembly=NINA.Core"
    xmlns:rules="clr-namespace:Assistant.NINAPlugin.Controls.ValidationRules"
    d:DesignHeight="500"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary Source="../Resources/Converters.xaml" />
    </UserControl.Resources>

    <StackPanel
        Width="600"
        Margin="20,20,0,0"
        Orientation="Vertical">
        <Label
            Margin="0,0,0,16"
            Content="Target"
            FontSize="18"
            FontWeight="Bold" />
        <UniformGrid
            Width="320"
            Height="160"
            Margin="12,0,0,6"
            HorizontalAlignment="Left"
            Columns="2"
            Rows="6">

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="Name"
                ToolTip="Name of the Target" />
            <TextBox MaxHeight="20" Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                <TextBox.Text>
                    <Binding Path="TargetProxy.Target.Name" UpdateSourceTrigger="LostFocus">
                        <Binding.ValidationRules>
                            <rules:RequiredFieldValidationRule />
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
            <TextBlock
                MaxHeight="20"
                Margin="3,3,0,0"
                Text="{Binding TargetProxy.Target.Name}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="RA"
                ToolTip="RA coordinate" />
            <StackPanel Orientation="Horizontal" Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <Binding Path="TargetProxy.Target.RAHours" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <nrules:HoursRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">h</TextBlock>
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <Binding Path="TargetProxy.Target.RAMinutes" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <nrules:MinutesRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">m</TextBlock>
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <Binding Path="TargetProxy.Target.RASeconds" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <nrules:SecondsRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">s</TextBlock>
            </StackPanel>
            <TextBlock
                MaxHeight="20"
                Text="{Binding TargetProxy.Target.RAString}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="Dec"
                ToolTip="Dec coordinate" />
            <StackPanel Orientation="Horizontal" Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <MultiBinding Converter="{StaticResource DecDegreeConverter}" UpdateSourceTrigger="LostFocus">
                            <Binding Path="TargetProxy.Target.NegativeDec" />
                            <Binding Path="TargetProxy.Target.DecDegrees">
                                <Binding.ValidationRules>
                                    <nrules:DegreesRule />
                                </Binding.ValidationRules>
                            </Binding>
                        </MultiBinding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">d</TextBlock>
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <Binding Path="TargetProxy.Target.DecMinutes" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <nrules:MinutesRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">m</TextBlock>
                <TextBox
                    MinWidth="40"
                    Margin="5,0,0,0"
                    TextAlignment="Right">
                    <TextBox.Text>
                        <Binding Path="TargetProxy.Target.DecSeconds" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <nrules:SecondsRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <TextBlock VerticalAlignment="Center">s</TextBlock>
            </StackPanel>
            <TextBlock
                MaxHeight="20"
                Text="{Binding TargetProxy.Target.DecString}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="Epoch"
                ToolTip="Epoch of the coordinates" />
            <ComboBox
                MaxHeight="20"
                ItemsSource="{Binding Source={local:EnumBindingSource {x:Type astro:Epoch}}}"
                SelectedValue="{Binding TargetProxy.Target.Epoch}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
            <TextBlock
                MaxHeight="20"
                Margin="3,3,0,0"
                Text="{Binding TargetProxy.Target.Epoch}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="Rotation"
                ToolTip="Target rotation" />
            <TextBox MaxHeight="20" Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                <TextBox.Text>
                    <Binding Path="TargetProxy.Target.Rotation" UpdateSourceTrigger="LostFocus">
                        <Binding.ValidationRules>
                            <rules:DoubleRangeRule>
                                <rules:DoubleRangeRule.ValidRange>
                                    <rules:DoubleRangeChecker Maximum="360" Minimum="0" />
                                </rules:DoubleRangeRule.ValidRange>
                            </rules:DoubleRangeRule>
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
            <TextBlock
                MaxHeight="20"
                Text="{Binding TargetProxy.Target.Rotation, Converter={StaticResource DegreesDisplayConverter}}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

            <TextBlock
                VerticalAlignment="Center"
                FontWeight="Bold"
                Text="ROI"
                ToolTip="Target region of interest" />
            <TextBox MaxHeight="20" Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                <TextBox.Text>
                    <Binding Path="TargetProxy.Target.ROI" UpdateSourceTrigger="LostFocus">
                        <Binding.ValidationRules>
                            <rules:DoubleRangeRule>
                                <rules:DoubleRangeRule.ValidRange>
                                    <rules:DoubleRangeChecker Maximum="1" Minimum="0.1" />
                                </rules:DoubleRangeRule.ValidRange>
                            </rules:DoubleRangeRule>
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
            <TextBlock
                MaxHeight="20"
                Text="{Binding TargetProxy.Target.ROI}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />

        </UniformGrid>

        <UniformGrid
            Width="140"
            Margin="20,26,0,0"
            HorizontalAlignment="Left">
            <Button
                Width="50"
                Height="34"
                VerticalAlignment="Center"
                HorizontalContentAlignment="Right"
                Command="{Binding EditCommand}"
                Content="Edit"
                Style="{StaticResource SecondaryBackgroundButton}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}" />
            <Button
                Width="50"
                Height="34"
                VerticalAlignment="Center"
                HorizontalContentAlignment="Right"
                Command="{Binding SaveCommand}"
                Content="Save"
                IsEnabled="{Binding TargetChanged}"
                Style="{StaticResource SecondaryBackgroundButton}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
            <Button
                Width="56"
                Height="34"
                VerticalAlignment="Center"
                HorizontalContentAlignment="Right"
                Command="{Binding CancelCommand}"
                Content="Cancel"
                Style="{StaticResource SecondaryBackgroundButton}"
                Visibility="{Binding ShowTargetEditView, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
        </UniformGrid>

    </StackPanel>
</UserControl>
